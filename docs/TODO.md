# 🚀 FamilyHubApp リリース ToDo リスト

## Ⅰ. 全般的な準備

1.  **Git リポジトリの最終確認:**
    - [ ] `main` (または `master`) ブランチが最新かつ安定した状態であることを確認。
    - [ ] 不要なファイルや機密情報がコミットされていないか確認 (`.gitignore` の検証）。
    - [ ] `README.md` に基本的なセットアップ方法、実行方法、テスト方法が記載されているか確認。
2.  **ドメイン名の準備 (任意):**
    - [ ] カスタムドメインを使用する場合、取得済みか確認。
3.  **各サービスのアカウント作成:**
    - [ ] [Vercel](https://vercel.com/) アカウント作成。
    - [ ] [Render](https://render.com/) アカウント作成。

---

## Ⅱ. フロントエンドデプロイ (Vite + React on Vercel)

1.  **コード準備:**
    - [ ] API エンドポイントの向き先を確認:
      - 開発用のプロキシ設定 (`vite.config.js` の `proxy`) は本番では機能しません。
      - フロントエンドのコード内で API を呼び出す際のベース URL を、**デプロイされるバックエンドの URL**に変更する必要があります。これは通常、Vercel の環境変数（例: `VITE_API_BASE_URL`）を使って設定します。
      - `src/api/axios.js` や API 呼び出しを行っている箇所を確認し、環境変数から API ベース URL を読み込むように修正。
    - [ ] `package.json` のビルドスクリプト (`"build": "vite build"`) を確認。
    - [ ] ローカルで `npm run build` (または `yarn build`) を実行し、`dist` ディレクトリに静的ファイルが正しく生成されることを確認。
2.  **Vercel プロジェクト作成と設定:**
    - [ ] Vercel にログインし、新しいプロジェクトを作成。
    - [ ] フロントエンドの Git リポジトリを連携。
    - [ ] フレームワークプリセットとして「Vite」を選択（通常は自動検出）。
    - [ ] ビルドコマンド (`vite build` または `npm run build`) と出力ディレクトリ (`dist`) が正しく設定されているか確認。
    - [ ] **環境変数を設定:**
      - `VITE_API_BASE_URL`: デプロイするバックエンド API の URL（例: `https://your-familyhubapp-backend.onrender.com/api/v1`）。これはバックエンドデプロイ後に確定します。
3.  **デプロイ実行:**
    - [ ] Vercel が Git プッシュをトリガーに自動でビルド＆デプロイを実行。
    - [ ] デプロイログを確認し、エラーがないことを確認。
4.  **動作確認 (Vercel デプロイ後):**
    - [ ] Vercel から提供された URL にアクセスし、フロントエンドが表示されることを確認。
    - [ ] (バックエンドデプロイ後) API 連携が正しく動作し、データが表示・操作できることを確認。ブラウザのコンソールでエラーが出ていないか確認。

---

## Ⅲ. データベース準備 (PostgreSQL on Render)

1.  **Render プロジェクト作成 (PostgreSQL):**
    - [ ] Render にログインし、新しい「PostgreSQL」サービスを作成。
    - [ ] データベース名、ユーザー名を設定（例: `familyhubapp_db`, `familyhub_user`）。パスワードは自動生成されるか、設定します。
    - [ ] リージョンを選択（ユーザーに近い場所、またはバックエンドと同じ場所）。
    - [ ] 無料プランを選択。
2.  **接続情報の確認:**
    - [ ] 作成された PostgreSQL インスタンスの**内部接続文字列 (Internal Connection String)** または各接続パラメータ（ホスト、ポート、DB 名、ユーザー、パスワード）を控えておく。これがバックエンドの `DATABASE_URL` 環境変数になります。
3.  **初期テーブル作成 (マイグレーション):**
    - [ ] バックエンドのデプロイ後、Alembic マイグレーションを実行してテーブルスキーマを作成します。（詳細はバックエンドのセクションで）

---

## Ⅳ. バックエンドデプロイ (FastAPI + Python on Render)

1.  **コード準備:**
    - [ ] `Dockerfile` の最終確認:
      - `CMD` 命令が本番用になっていることを確認 (例: `uvicorn app.main:app --host 0.0.0.0 --port 8000` または `gunicorn ...`)。`--reload` オプションは削除。
      - もし Gunicorn を使う場合、`requirements.txt` に `gunicorn` が追加されていることを確認。
    - [ ] `requirements.txt` の最終確認。
    - [ ] Alembic のマイグレーションファイルが最新で、モデル定義と一致していることを確認。
2.  **Render プロジェクト作成 (Web Service):**
    - [ ] Render にログインし、新しい「Web Service」を作成。
    - [ ] バックエンドの Git リポジトリを連携（または事前にビルドした Docker イメージをコンテナレジストリにプッシュし、それを指定）。
    - [ ] ランタイムとして「Docker」を選択。
    - [ ] Dockerfile のパスが正しいことを確認（通常はリポジトリルート）。
    - [ ] リージョンを選択（データベースと同じ場所が望ましい）。
    - [ ] インスタンスタイプとして無料プランを選択。
    - [ ] **環境変数を設定:**
      - `DATABASE_URL`: Render で作成した PostgreSQL の**内部接続文字列**に設定（例: `postgresql+asyncpg://user:password@host:port/db`）。
      - `SECRET_KEY`: 強力なシークレットキーを設定。
      - `ALGORITHM`: JWT アルゴリズム（例: `HS256`）。
      - `ACCESS_TOKEN_EXPIRE_MINUTES`: トークン有効期限（例: `30`）。
      - `PYTHON_VERSION`: (Dockerfile で指定していれば不要な場合も)
      - その他、アプリケーションが必要とする環境変数。
    - [ ] **ヘルスチェックパス:** (任意だが推奨) FastAPI の簡単なヘルスチェック用エンドポイント（例: `/health` で 200 OK を返す）を作成し、Render に設定。
    - [ ] **スタートコマンド:** (Dockerfile の CMD で指定していれば通常不要)
3.  **初回デプロイとマイグレーション:**
    - [ ] Render で「Create Web Service」を実行し、最初のビルドとデプロイを開始。
    - [ ] デプロイログを確認し、エラーがないことを確認。
    - [ ] デプロイが完了したら、Render の機能（例: Shell タブ、One-off jobs）を使って**Alembic マイグレーションを実行**します。
      ```bash
      alembic upgrade head
      ```
      (Render の環境では `docker compose run ...` ではなく、サービス環境内で直接 `alembic` コマンドを実行できる形になります)
4.  **動作確認 (バックエンドデプロイ後):**
    - [ ] Render から提供されたバックエンドサービスの URL（例: `https://your-familyhubapp-backend.onrender.com`）にアクセスし、ルートパス（`/`）や `/docs` が表示されることを確認。
    - [ ] (フロントエンドデプロイ後) フロントエンドからの API 呼び出しが正しく動作することを確認。

---

## Ⅴ. 最終連携確認とテスト

1.  [ ] フロントエンドの `VITE_API_BASE_URL` が、デプロイされたバックエンドの正しい URL を指していることを再確認。
2.  [ ] フロントエンドの全機能を一通りテストし、データの作成・読み取り・更新・削除が正しく行えることを確認。
3.  [ ] OIDC 認証フローを実装する場合、認証・認可が正しく機能することを確認。
4.  [ ] レスポンスタイムやエラーログなどを監視。

---

## Ⅵ. 今後の運用・保守（考慮事項）

- [ ] 定期的なバックアップ（Render の DB は自動バックアップがあるか確認）。
- [ ] ログ監視設定。
- [ ] セキュリティアップデートの適用。
- [ ] (将来的に) カスタムドメインの設定。

---
