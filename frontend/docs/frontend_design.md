# SyncFam フロントエンド設計ドキュメント

## 1. プロジェクト概要と開発のゴール

- **プロジェクト名:** SyncFam - 家族向けハブアプリ
- **対象機能:**
  - タスクの一覧表示、作成、編集、削除、完了/未完了切り替え
  - 家族メンバー管理
  - カレンダー表示
  - 献立管理
  - お出かけスポット管理
- **開発ゴール:**
  - 共働き家庭の日常的なタスク管理を効率化する
  - 家族のスケジュール・献立・情報を一元管理できるハブとなるアプリを提供する
  - MVP として早期に利用可能な状態を目指し、ユーザーからのフィードバックを迅速に得る
  - **開発方針:** スピード優先、作り込みすぎない、手戻り防止、ステップバイステップでの進行

## 2. 実装状況の概要

| 機能                 | 状態        | 備考                                          |
| -------------------- | ----------- | --------------------------------------------- |
| 基本インフラ環境構築 | ✅ 完了     | React, Redux Toolkit, MUI, TypeScript        |
| ユーザー管理         | ✅ 完了     | 登録、ログイン、プロフィール                  |
| 家族管理             | ✅ 完了     | 表示、切り替え、メンバー表示                  |
| タスク管理           | ✅ 完了     | 一覧表示、作成、編集、削除、フィルタリング    |
| サブタスク管理       | ✅ 完了     | 作成、ツリー表示、階層構造                    |
| ダッシュボード       | ✅ 完了     | タスク概要、カレンダー、献立、お出かけ        |
| カレンダー           | 🔄 未実装   | ダッシュボードのウィジェットのみ実装済み      |
| 献立管理             | 🔄 未実装   | ダッシュボードのウィジェットのみ実装済み      |
| お出かけスポット     | 🔄 未実装   | ダッシュボードのウィジェットのみ実装済み      |

## 3. ターゲットユーザー

- 共働き家族（特にテクノロジーに親しみのある世帯）
- 子育て中の家族
- PC およびスマートフォンでの利用を想定（初期は PC 向け、段階的にレスポンシブ対応予定）

## 4. 技術スタック

- **UI ライブラリ:** React (v18)
- **TypeScript:** 型安全なコード開発のため
- **状態管理:** Redux Toolkit
- **UI コンポーネントライブラリ:** MUI (Material-UI) v5
- **ルーティング:** React Router v6
- **API クライアント:** Axios + カスタムフック
- **フォーム管理:** React Hook Form + Zod
- **CSS:** Tailwind CSS（MUI との併用）
- **ビルドツール:** Vite

## 5. 技術選定と設計方針

### 5.1. API クライアント

- **選定:** Axios + カスタムフック
- **選定理由:**
  - Axios: 広く使われており、ドキュメントが充実。インターセプターなどの機能が豊富
  - カスタムフック: Redux の Thunk よりも柔軟で、コンポーネントで直接使いやすい
- **基本的な使い方/設定方針:**
  - `src/api/client.ts` でベースとなるクライアントを設定
  - 認証トークンの自動付与や、リフレッシュトークンの処理などをインターセプターで実装
  - 各機能（タスク、家族など）ごとに API フックを作成（`src/api/hooks/useTaskApi.ts` など）

### 5.2. 状態管理アーキテクチャ

- **選定ライブラリ**: Redux Toolkit
- **選定理由**:
  - 標準的なReduxの冗長性を解消
  - 型安全なAction/Reducerの作成が容易
  - createAsyncThunkによる非同期処理の管理が容易
- **主要なState管理**:
  - AuthState: ユーザー認証状態、現在の家族情報
  - UIState: フィルター条件、表示状態、モーダル表示など
  - EntityState: バックエンドから取得したデータのキャッシュ
- **データフロー**:
  1. コンポーネントがAPIフックを通じてデータ取得
  2. 必要に応じてReduxストアに保存
  3. useSelectorでデータを参照

### 5.3. ルーティング

- **選定ライブラリ:** React Router Dom v6
- **選定理由:**
  - React アプリの事実上の標準ライブラリ
  - v6 では宣言的なルーティングがより簡潔になり、ネストされたルートの扱いも改善
- **基本的なルーティング構成案:**
  - `/login` - ログイン画面
  - `/register` - ユーザー登録
  - `/dashboard` - メインダッシュボード
  - `/tasks` - タスク管理画面
  - `/calendar` - カレンダー画面（未実装）
  - `/menu` - 献立管理画面（未実装）
  - `/places` - お出かけスポット管理画面（未実装）
  - `/settings` - アプリ設定画面（未実装）
  - `/family` - 家族設定画面

### 5.4. フォーム管理

- **選定ライブラリ:** React Hook Form + Zod
- **選定理由:**
  - React Hook Form: パフォーマンスが高く、不要な再レンダリングを抑制
  - Zod: TypeScript との相性が良く、スキーマからの型推論が強力
  - MUI との連携が容易
- **Zod スキーマとの連携方法:**
  - バックエンドのAPI仕様に合わせてスキーマを定義
  - `@hookform/resolvers/zod` を使って Zod スキーマを React Hook Form のバリデーションとして利用
  - フォームの型安全性を確保

### 5.5. ディレクトリ構成

```
frontend/
├── public/            # 静的ファイル
├── src/
│   ├── api/           # API関連
│   │   ├── client.ts  # Axiosベースクライアント
│   │   └── hooks/     # APIカスタムフック
│   ├── app/           # アプリケーション設定
│   │   ├── store.ts   # Reduxストア
│   │   └── router.tsx # ルーティング設定
│   ├── components/    # 共通コンポーネント
│   │   ├── atoms/     # 基本要素（ボタン、入力など）
│   │   ├── molecules/ # 複合要素（フォームグループなど）
│   │   ├── organisms/ # 機能単位（タスクリストなど）
│   │   ├── templates/ # ページレイアウト
│   │   └── ui/        # 共通UI要素
│   ├── contexts/      # Reactコンテキスト
│   ├── features/      # 機能モジュール
│   │   ├── auth/      # 認証関連
│   │   ├── tasks/     # タスク管理
│   │   ├── dashboard/ # ダッシュボード
│   │   └── family/    # 家族管理
│   ├── hooks/         # 共通カスタムフック
│   ├── layouts/       # レイアウトコンポーネント
│   ├── styles/        # グローバルスタイル
│   ├── types/         # 型定義
│   ├── utils/         # ユーティリティ関数
│   ├── App.tsx        # アプリルート
│   ├── main.tsx       # エントリーポイント
│   └── vite-env.d.ts  # Vite環境変数型定義
```

## 6. UI/UX デザイン基本方針

### 6.1. 全体的なデザインコンセプト

- **目指すスタイル:**
  - クリーン、モダン、使いやすさを重視
  - MUI をベースとしつつ、Tailwind CSS でカスタマイズ
  - 情報の整理と優先順位付けを明確に
  - モバイルファーストの考え方（優先度は低いがデザイン時に考慮）
- **配色:**
  - プライマリカラー: #3f51b5（インディゴ）
  - セカンダリカラー: #f50057（ピンク）
  - アクセントカラー: #00bcd4（シアン）
  - ニュートラル: グレースケール（#f5f5f5〜#212121）
- **タイポグラフィ:**
  - 基本フォント: Roboto
  - 見出し: Roboto（ウェイト: 500, 700）
  - 本文: Roboto（ウェイト: 400）

### 6.2. 主要画面のレイアウト構成

#### **ダッシュボード画面:**

- タスク概要ウィジェット（今日のタスク一覧）
- カレンダーウィジェット（今日と今後の予定）
- 献立ウィジェット（今日の献立）
- お出かけスポットウィジェット（おすすめスポット）

#### **タスク一覧画面:**

- フィルターパネル（状態、優先度、期限日などでフィルタリング）
- 表示切替（フラットビュー / ツリービュー）
- タスクリスト（タイトル、ステータス、優先度、期限日、担当者、タグ）
- 新規タスク追加ボタン
- タスク編集モーダル

#### **家族画面:**

- 家族一覧パネル
- 家族メンバー一覧パネル
- 家族追加・編集機能

## 7. 認証とデータフロー

### 7.1. 認証フロー

1. **ログイン/新規登録:**
   - ユーザーがログインページでメールアドレスとパスワードを入力
   - APIリクエストでトークンを取得
   - トークンをメモリに保存（セキュリティのためLocalStorageは不使用）
   - Redux storeにユーザー情報を保存

2. **自動認証:**
   - アプリ起動時にセッションチェック
   - リフレッシュトークンによる自動再認証
   - 認証失敗時はログイン画面にリダイレクト

3. **ログアウト:**
   - ユーザーがログアウトボタンをクリック
   - APIでのログアウト処理
   - トークンとユーザー情報をクリア
   - ログイン画面にリダイレクト

### 7.2. データフローパターン

1. **APIデータ取得フロー:**
   - コンポーネントがマウントされたときにAPIフックを呼び出し
   - ローディング状態を表示
   - データ取得成功時に画面に表示
   - エラー発生時にエラーメッセージを表示

2. **フォーム送信フロー:**
   - ユーザーがフォームに入力
   - Zodによるバリデーション実行
   - 送信ボタンクリックでAPIフックを呼び出し
   - 成功時にフィードバックを表示し、必要に応じて画面遷移
   - エラー時にフォームにエラーメッセージを表示

3. **通知フロー:**
   - 操作結果（成功/失敗）をスナックバーで通知
   - グローバル通知コンテキストを使用して一元管理
   - 自動的に一定時間後に非表示

## 8. コンポーネント設計

### 8.1. コンポーネント階層

- **Atoms**: 基本的なUI要素（ボタン、入力フィールド、アイコンなど）
- **Molecules**: 複数のAtomsを組み合わせた要素（フォームフィールド、カードなど）
- **Organisms**: 機能的なコンポーネント（タスクリスト、フィルターパネルなど）
- **Templates**: ページのレイアウト構造（ダッシュボードテンプレート、タスクページテンプレートなど）
- **Pages**: ルーティングに対応した完全なページ（ダッシュボードページ、タスクページなど）

### 8.2. 主要コンポーネント

#### タスク関連

- **TaskList**: タスクの一覧表示
- **TaskListWithSubtasks**: サブタスクを含むタスクのツリー表示
- **TaskFormDialog**: タスクの作成・編集用モーダルダイアログ
- **SubtaskFormDialog**: サブタスク作成用モーダルダイアログ
- **TaskFilterPanel**: タスクのフィルタリング条件を設定するパネル

#### ダッシュボード関連

- **TaskSummaryWidget**: 今日のタスク概要を表示するウィジェット
- **CalendarWidget**: スケジュールを表示するウィジェット
- **MenuWidget**: 今日の献立を表示するウィジェット
- **PlacesWidget**: お出かけスポットを表示するウィジェット

#### 認証関連

- **LoginPage**: ログインフォーム
- **RegisterPage**: 新規登録フォーム
- **ProtectedRoute**: 認証済みユーザーのみアクセス可能なルートを制御

#### レイアウト

- **MainLayout**: 認証済みユーザー向けのメインレイアウト（サイドバー、ヘッダー、メインコンテンツ）

## 9. エラーハンドリングと通知

### 9.1. エラーハンドリング戦略

1. **API エラー処理:**
   - Axios インターセプターでグローバルエラーハンドリング
   - 401 エラー時の自動リフレッシュトークン処理
   - 認証エラー発生時の自動ログアウト処理
   - API フックでの try/catch によるエラー捕捉

2. **フォームエラー:**
   - Zod スキーマによるバリデーションエラー表示
   - API エラーメッセージのフォームへの反映

3. **UI フィードバック:**
   - エラー時のスナックバー通知
   - フォームフィールド下部のエラーメッセージ
   - ローディング状態の視覚的表示

### 9.2. 通知システム

- **NotificationContext**: アプリ全体で使用する通知システム
- **NotificationContainer**: 通知をスタック形式で表示するコンポーネント
- **通知タイプ**:
  - success: 成功通知（緑色）
  - error: エラー通知（赤色）
  - info: 情報通知（青色）
  - warning: 警告通知（オレンジ色）
- **使用例**:
  ```tsx
  const { addNotification } = useNotification();
  
  // 成功通知
  addNotification({
    message: 'タスクが作成されました',
    type: 'success',
    duration: 3000
  });
  
  // エラー通知
  addNotification({
    message: 'タスクの作成に失敗しました',
    type: 'error',
    duration: 5000
  });
  ```

## 10. パフォーマンス最適化

### 10.1. レンダリング最適化

- **React.memo**: 不必要な再レンダリングを防止
- **useMemo/useCallback**: 計算コストの高い処理や関数を最適化
- **仮想化リスト**: 大量のリストアイテムを効率的にレンダリング（未実装）

### 10.2. データ取得最適化

- **キャッシュ**: 取得済みデータの再利用
- **楽観的UI更新**: API レスポンスを待たずに UI を即時更新
- **ページネーション**: 大量データの分割取得
- **デバウンス**: 検索やフィルター入力時の過剰なリクエスト防止

### 10.3. バンドルサイズ最適化

- **コード分割**: React.lazy と Suspense を使用した遅延ローディング
- **Tree Shaking**: 未使用コードの除去
- **画像最適化**: 適切なフォーマットとサイズの使用

## 11. 今後の実装計画

### フェーズ 1: 現機能の改善と拡充

- **タスク機能の強化**:
  - タスクの並び替え機能（ドラッグ＆ドロップ）
  - 定期的なタスクの繰り返し設定
  - タスクのバルク編集機能

- **レスポンシブ対応の強化**:
  - モバイル向けUI最適化
  - タッチ操作の改善

- **UX改善**:
  - ダークモード対応
  - ユーザー設定画面
  - 通知機能の強化

### フェーズ 2: 新機能実装

- **カレンダー機能**:
  - 月間/週間/日間ビュー
  - タスクとイベントの一元管理
  - 繰り返しイベント
  - リマインダー機能

- **献立管理機能**:
  - 毎日の献立計画
  - レシピ保存
  - 買い物リスト自動生成
  - 栄養バランス表示

- **お出かけスポット管理**:
  - 家族のお気に入りスポット登録
  - カテゴリ分類（屋内/屋外、無料/有料など）
  - 天気連携
  - 訪問履歴管理

### フェーズ 3: 拡張機能

- **家計簿機能**:
  - 家族の支出管理
  - 予算設定と追跡
  - グラフによる可視化

- **家族アルバム機能**:
  - 思い出の写真管理
  - タイムライン表示
  - 共有機能

- **外部サービス連携**:
  - Google カレンダー連携
  - スマートホーム連携
  - 買い物サービス連携

## 12. コード品質管理

### 12.1. コーディング規約

- **ESLint**: コード品質チェック（TypeScript対応設定）
- **Prettier**: コードフォーマット統一
- **TypeScript**: 型チェックによるバグ防止
- **Import順序**: ライブラリ、内部モジュール、相対パスの順に統一

### 12.2. テスト戦略

- **単体テスト**: React Testing Libraryを使用したコンポーネントテスト
- **統合テスト**: ユーザーフローのシミュレーション
- **E2Eテスト**: 将来的にCypressなどでの実装を検討

### 12.3. CI/CD

- **GitHub Actions**: プッシュ時の自動ビルドとテスト
- **自動デプロイ**: Vercelなどへの自動デプロイ
- **環境分離**: 開発/ステージング/本番環境の分離

## 13. バックエンド連携

### 13.1. API インタフェース

- **ベースURL**: `/api/v1`
- **認証**: JWTトークンによるBearer認証
- **エラーハンドリング**: 統一されたエラーレスポンス形式
- **Proxyの利用**: 開発時はバックエンドへのリクエストをプロキシ

### 13.2. データのキャッシュ戦略

- **メモリキャッシュ**: Redux Storeを利用した一時的なデータキャッシュ
- **キャッシュの無効化**: データ更新時の自動キャッシュ更新
- **ストール時キャッシュ**: ネットワークエラー時に古いデータを表示
