# SyncFam ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## æ¦‚è¦

SyncFam ã¯å®¶æ—å‘ã‘ã®ã‚¿ã‚¹ã‚¯ç®¡ç†ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«èª¿æ•´ãƒ»çŒ®ç«‹ç®¡ç†ãƒ»ãŠå‡ºã‹ã‘ã‚¹ãƒãƒƒãƒˆè¨˜éŒ²ãªã©ã®æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ãƒãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã®è¨­è¨ˆã¨å®Ÿè£…çŠ¶æ³ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## å®Ÿè£…çŠ¶æ³ã®æ¦‚è¦

| æ©Ÿèƒ½                 | çŠ¶æ…‹        | å‚™è€ƒ                                          |
| -------------------- | ----------- | --------------------------------------------- |
| åŸºæœ¬ã‚¤ãƒ³ãƒ•ãƒ©ç’°å¢ƒæ§‹ç¯‰ | âœ… å®Œäº†     | FastAPI, SQLAlchemy, PostgreSQL, Docker, Ruff |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†         | âœ… å®Œäº†     | ç™»éŒ²ã€èªè¨¼ï¼ˆJWTï¼‰ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«               |
| å®¶æ—ç®¡ç†             | âœ… å®Œäº†     | ä½œæˆã€ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ ã€æ¨©é™ç®¡ç†                  |
| ã‚¿ã‚¹ã‚¯ç®¡ç†           | âœ… å®Œäº†     | ä½œæˆã€ä¸€è¦§ã€è©³ç´°ã€æ›´æ–°ã€å‰Šé™¤ã€ã‚¿ã‚°ç®¡ç†        |
| ã‚µãƒ–ã‚¿ã‚¹ã‚¯ç®¡ç†       | âœ… å®Œäº†     | è¦ªã‚¿ã‚¹ã‚¯ã®ä¸‹ã«å­ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã€ãƒ„ãƒªãƒ¼è¡¨ç¤º      |
| ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç®¡ç†       | ğŸ”„ æœªå®Ÿè£…   | ä»Šå¾Œã®å®Ÿè£…äºˆå®š                                |
| çŒ®ç«‹ç®¡ç†             | ğŸ”„ æœªå®Ÿè£…   | ä»Šå¾Œã®å®Ÿè£…äºˆå®š                                |
| ãŠå‡ºã‹ã‘ã‚¹ãƒãƒƒãƒˆ     | ğŸ”„ æœªå®Ÿè£…   | ä»Šå¾Œã®å®Ÿè£…äºˆå®š                                |
| ãƒ†ã‚¹ãƒˆ               | âš ï¸ ä¸€éƒ¨å®Ÿè£… | åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆæ§‹é€ ã¯ã‚ã‚‹ãŒæ‹¡å……ãŒå¿…è¦          |

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ–¹é‡

æœ¬ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯ã€é–¢å¿ƒäº‹ã®åˆ†é›¢ã‚’ç›®çš„ã¨ã—ãŸ**ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚ä¸»ãªãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ãã®è²¬å‹™ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

1.  **API ãƒ¬ã‚¤ãƒ¤ãƒ¼ (`app/routers/`)**:

    - HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å—ä»˜ã€ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ»ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è§£é‡ˆ
    - ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ`schemas`ã‚’åˆ©ç”¨ï¼‰
    - Service ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å‘¼ã³å‡ºã—
    - Service ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰ã®çµæœã‚’ HTTP ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆ`schemas`ã‚’åˆ©ç”¨ï¼‰ã«æ•´å½¢ã—ã¦è¿”å´
    - HTTP ãƒ¬ãƒ™ãƒ«ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆä¾‹: 404 Not Foundï¼‰
    - ä¾å­˜æ€§æ³¨å…¥ï¼ˆDB ã‚»ãƒƒã‚·ãƒ§ãƒ³ãªã©ï¼‰ã®è§£æ±º
    - **è²¬å‹™:** HTTP é€šä¿¡ã«é–¢ã‚ã‚‹å‡¦ç†ã«é™å®šã—ã€ã€Œè–„ãã€ä¿ã¤

2.  **Service ãƒ¬ã‚¤ãƒ¤ãƒ¼ (`app/services/`)**:

    - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®å®Ÿè£…
    - è¤‡æ•°ã® CRUD æ“ä½œã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    - è¤‡é›‘ãªãƒ‡ãƒ¼ã‚¿åŠ å·¥ã‚„è¨ˆç®—
    - å¿…è¦ã«å¿œã˜ãŸãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œã®ç®¡ç†ï¼ˆè¤‡æ•°ã‚¹ãƒ†ãƒƒãƒ—ã«ã¾ãŸãŒã‚‹æ“ä½œãªã©ï¼‰
    - **è²¬å‹™:** ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã€Œä½•ã‚’ã™ã‚‹ã‹ã€ã‚’å®šç¾©ã™ã‚‹ä¸­å¿ƒçš„ãªå±¤

3.  **CRUD ãƒ¬ã‚¤ãƒ¤ãƒ¼ (`app/crud/`)**:

    - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å¯¾ã™ã‚‹åŸºæœ¬çš„ãªæ°¸ç¶šåŒ–æ“ä½œï¼ˆCreate, Read, Update, Deleteï¼‰
    - SQLAlchemy ã¨ DB ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’åˆ©ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹
    - ã‚¹ã‚­ãƒ¼ãƒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ DB ãƒ¢ãƒ‡ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé–“ã®å¤‰æ›
    - **è²¬å‹™:** ç‰¹å®šã®ãƒ¢ãƒ‡ãƒ«ã«å¯¾ã™ã‚‹ DB æ“ä½œã‚’ã‚«ãƒ—ã‚»ãƒ«åŒ–ã€‚ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯åŸå‰‡ã¨ã—ã¦å«ã¾ãªã„

4.  **ãƒ¢ãƒ‡ãƒ«ãƒ¬ã‚¤ãƒ¤ãƒ¼ (`app/models/`)**:

    - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ã€ã‚«ãƒ©ãƒ ã€ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ã‚’ SQLAlchemy ã‚¯ãƒ©ã‚¹ã§å®šç¾©
    - **è²¬å‹™:** ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ‰±ã†ãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ ã‚’å®šç¾©

5.  **ã‚¹ã‚­ãƒ¼ãƒãƒ¬ã‚¤ãƒ¤ãƒ¼ (`app/schemas/`)**:

    - API ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼‰ã§åˆ©ç”¨ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«ã‚’ Pydantic ã‚¯ãƒ©ã‚¹ã§å®šç¾©
    - **è²¬å‹™:** API ã®ãƒ‡ãƒ¼ã‚¿ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’å®šç¾©

6.  **ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ãƒ¬ã‚¤ãƒ¤ãƒ¼ (`app/db/`, `app/core/`, etc.)**:
    - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã€è¨­å®šç®¡ç†ã€å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æºãªã©
    - **è²¬å‹™:** ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åŸºç›¤ã®æä¾›

### æŠ€è¡“çš„è² å‚µã‚’æŠ‘ãˆã‚‹ãŸã‚ã®åŸå‰‡

é–‹ç™ºé€Ÿåº¦ã‚’å„ªå…ˆã—ã¤ã¤ã‚‚æŠ€è¡“çš„è² å‚µã‚’æŠ‘ãˆã‚‹ãŸã‚ã€ä»¥ä¸‹ã®åŸå‰‡ã‚’å®ˆã‚Šã¾ã—ã‚‡ã†ï¼š

1. **æ˜ç¢ºãªè²¬å‹™åˆ†é›¢**: å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è²¬å‹™ã‚’æ˜ç¢ºã«åˆ†ã‘ã‚‹
2. **é©åˆ‡ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–**: ã‚³ãƒ¼ãƒ‰å†…ã®ã‚³ãƒ¡ãƒ³ãƒˆã¨æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°
3. **ã‚³ãƒ¼ãƒ‰å“è³ªã®ç¶­æŒ**: `ruff`ã«ã‚ˆã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨ãƒªãƒ³ãƒˆ
4. **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**: ä¸»è¦æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆä½œæˆ
5. **æ®µéšçš„ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°**: å¿…è¦ã«å¿œã˜ã¦å°ã•ãªç¯„å›²ã§ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### ä¸»è¦ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼ (User)

```python
class User(Base):
    __tablename__ = "users"

    id: Mapped[uuid.UUID] = mapped_column(primary_key=True, default=uuid.uuid4)
    email: Mapped[str] = mapped_column(String, unique=True, index=True)
    hashed_password: Mapped[str] = mapped_column(String)
    first_name: Mapped[str] = mapped_column(String)
    last_name: Mapped[str] = mapped_column(String)
    avatar_url: Mapped[Optional[str]] = mapped_column(String, nullable=True)
    is_active: Mapped[bool] = mapped_column(default=True)
    created_at: Mapped[datetime] = mapped_column(default=datetime.utcnow)
    updated_at: Mapped[datetime] = mapped_column(
        default=datetime.utcnow, onupdate=datetime.utcnow
    )

    # ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—
    family_memberships: Mapped[List["FamilyMember"]] = relationship(
        "FamilyMember", back_populates="user", cascade="all, delete-orphan"
    )
    assigned_tasks: Mapped[List["Task"]] = relationship(
        "Task", foreign_keys="Task.assignee_id", back_populates="assignee"
    )
    created_tasks: Mapped[List["Task"]] = relationship(
        "Task", foreign_keys="Task.created_by_id", back_populates="created_by"
    )
```

#### å®¶æ— (Family)

```python
class Family(Base):
    __tablename__ = "families"

    id: Mapped[uuid.UUID] = mapped_column(primary_key=True, default=uuid.uuid4)
    name: Mapped[str] = mapped_column(String)
    created_at: Mapped[datetime] = mapped_column(default=datetime.utcnow)
    updated_at: Mapped[datetime] = mapped_column(
        default=datetime.utcnow, onupdate=datetime.utcnow
    )

    # ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—
    members: Mapped[List["FamilyMember"]] = relationship(
        back_populates="family", cascade="all, delete-orphan"
    )
    tasks: Mapped[List["Task"]] = relationship(
        "Task", back_populates="family", cascade="all, delete-orphan"
    )
    tags: Mapped[List["Tag"]] = relationship(
        "Tag", back_populates="family", cascade="all, delete-orphan"
    )
```

#### å®¶æ—ãƒ¡ãƒ³ãƒãƒ¼ (FamilyMember)

```python
class FamilyMember(Base):
    __tablename__ = "family_members"

    id: Mapped[uuid.UUID] = mapped_column(primary_key=True, default=uuid.uuid4)
    user_id: Mapped[uuid.UUID] = mapped_column(
        ForeignKey("users.id", ondelete="CASCADE")
    )
    family_id: Mapped[uuid.UUID] = mapped_column(
        ForeignKey("families.id", ondelete="CASCADE")
    )
    role: Mapped[str] = mapped_column(String)  # 'parent', 'child', 'other'
    is_admin: Mapped[bool] = mapped_column(default=False)
    joined_at: Mapped[datetime] = mapped_column(default=datetime.utcnow)

    # ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—
    user: Mapped["User"] = relationship("User", back_populates="family_memberships")
    family: Mapped[Family] = relationship(Family, back_populates="members")

    __table_args__ = (UniqueConstraint("user_id", "family_id", name="uq_user_family"),)
```

#### ã‚¿ã‚¹ã‚¯ (Task)

```python
class Task(Base):
    __tablename__ = "tasks"

    id: Mapped[uuid.UUID] = mapped_column(primary_key=True, default=uuid.uuid4)
    title: Mapped[str] = mapped_column(String)
    description: Mapped[Optional[str]] = mapped_column(Text, nullable=True)
    family_id: Mapped[uuid.UUID] = mapped_column(
        ForeignKey("families.id", ondelete="CASCADE")
    )
    assignee_id: Mapped[Optional[uuid.UUID]] = mapped_column(
        ForeignKey("users.id", ondelete="SET NULL"), nullable=True
    )
    created_by_id: Mapped[uuid.UUID] = mapped_column(
        ForeignKey("users.id", ondelete="SET NULL")
    )
    due_date: Mapped[Optional[date]] = mapped_column(nullable=True)
    status: Mapped[str] = mapped_column(
        String, default="pending"
    )  # pending, in_progress, completed
    priority: Mapped[str] = mapped_column(String, default="medium")  # low, medium, high
    is_routine: Mapped[bool] = mapped_column(default=False)
    created_at: Mapped[datetime] = mapped_column(default=datetime.utcnow)
    updated_at: Mapped[datetime] = mapped_column(
        default=datetime.utcnow, onupdate=datetime.utcnow
    )

    # ã‚µãƒ–ã‚¿ã‚¹ã‚¯æ©Ÿèƒ½ã®ãŸã‚ã®è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
    parent_id: Mapped[Optional[uuid.UUID]] = mapped_column(
        ForeignKey("tasks.id", ondelete="CASCADE"), nullable=True
    )

    # ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—
    family: Mapped["Family"] = relationship("Family", back_populates="tasks", lazy="selectin")
    assignee: Mapped[Optional["User"]] = relationship(
        "User", foreign_keys=[assignee_id], back_populates="assigned_tasks", lazy="selectin"
    )
    created_by: Mapped["User"] = relationship(
        "User", foreign_keys=[created_by_id], back_populates="created_tasks", lazy="selectin"
    )
    tags: Mapped[List["Tag"]] = relationship(
        secondary=task_tags,
        back_populates="tasks",
        lazy="selectin",
    )

    # ã‚µãƒ–ã‚¿ã‚¹ã‚¯é–¢é€£ã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—
    parent: Mapped[Optional["Task"]] = relationship(
        "Task", remote_side=[id], back_populates="subtasks", foreign_keys=[parent_id]
    )
    subtasks: Mapped[List["Task"]] = relationship(
        "Task",
        back_populates="parent",
        cascade="all, delete-orphan",
        foreign_keys=[parent_id],
        lazy="selectin",
    )
```

#### ã‚¿ã‚° (Tag)

```python
class Tag(Base):
    __tablename__ = "tags"

    id: Mapped[uuid.UUID] = mapped_column(primary_key=True, default=uuid.uuid4)
    name: Mapped[str] = mapped_column(String)
    color: Mapped[Optional[str]] = mapped_column(String, nullable=True)
    family_id: Mapped[uuid.UUID] = mapped_column(
        ForeignKey("families.id", ondelete="CASCADE")
    )

    # ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—
    family: Mapped["Family"] = relationship("Family", back_populates="tags", lazy="selectin")
    tasks: Mapped[List[Task]] = relationship(
        secondary=task_tags,
        back_populates="tags",
        lazy="selectin",
    )

    __table_args__ = (UniqueConstraint("name", "family_id", name="uq_tag_name_family"),)
```

## API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### èªè¨¼é–¢é€£

- `POST /api/v1/auth/register` - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
- `POST /api/v1/auth/login` - ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆJWTãƒˆãƒ¼ã‚¯ãƒ³å–å¾—ï¼‰
- `POST /api/v1/auth/refresh` - ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°
- `GET /api/v1/auth/me` - ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—

### ãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢é€£

- `GET /api/v1/users/me` - è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—
- `PUT /api/v1/users/me` - è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°

### å®¶æ—é–¢é€£

- `POST /api/v1/families` - å®¶æ—ä½œæˆ
- `GET /api/v1/families` - è‡ªåˆ†ãŒæ‰€å±ã™ã‚‹å®¶æ—ä¸€è¦§å–å¾—
- `GET /api/v1/families/{family_id}` - å®¶æ—è©³ç´°å–å¾—
- `PUT /api/v1/families/{family_id}` - å®¶æ—æƒ…å ±æ›´æ–°
- `POST /api/v1/families/{family_id}/members` - å®¶æ—ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ 
- `GET /api/v1/families/{family_id}/members` - å®¶æ—ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§å–å¾—
- `DELETE /api/v1/families/{family_id}/members/{user_id}` - å®¶æ—ãƒ¡ãƒ³ãƒãƒ¼å‰Šé™¤

### ã‚¿ã‚¹ã‚¯é–¢é€£

- `POST /api/v1/tasks` - ã‚¿ã‚¹ã‚¯ä½œæˆ
- `GET /api/v1/tasks` - ã‚¿ã‚¹ã‚¯ä¸€è¦§å–å¾—ï¼ˆã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¯èƒ½ï¼‰
- `GET /api/v1/tasks/roots` - ãƒ«ãƒ¼ãƒˆã‚¿ã‚¹ã‚¯ä¸€è¦§å–å¾—ï¼ˆã‚µãƒ–ã‚¿ã‚¹ã‚¯ã‚‚å«ã‚€ï¼‰
- `GET /api/v1/tasks/{task_id}` - ã‚¿ã‚¹ã‚¯è©³ç´°å–å¾—
- `GET /api/v1/tasks/with-subtasks/{task_id}` - ã‚µãƒ–ã‚¿ã‚¹ã‚¯ã‚’å«ã‚€ã‚¿ã‚¹ã‚¯è©³ç´°å–å¾—
- `POST /api/v1/tasks/{task_id}/subtasks` - ã‚µãƒ–ã‚¿ã‚¹ã‚¯ä½œæˆ
- `PUT /api/v1/tasks/{task_id}` - ã‚¿ã‚¹ã‚¯æ›´æ–°
- `DELETE /api/v1/tasks/{task_id}` - ã‚¿ã‚¹ã‚¯å‰Šé™¤

### ã‚¿ã‚°é–¢é€£

- `POST /api/v1/tags` - ã‚¿ã‚°ä½œæˆ
- `GET /api/v1/tags/family/{family_id}` - ç‰¹å®šã®å®¶æ—ã®ã‚¿ã‚°ä¸€è¦§å–å¾—
- `PUT /api/v1/tags/{tag_id}` - ã‚¿ã‚°æ›´æ–°
- `DELETE /api/v1/tags/{tag_id}` - ã‚¿ã‚°å‰Šé™¤

## ä»Šå¾Œã®å®Ÿè£…è¨ˆç”»

### ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç®¡ç†æ©Ÿèƒ½

ãƒ¯ã‚¤ãƒ¤ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’å‚è€ƒã«ã€ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹äºˆå®šã§ã™ï¼š

1. **ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«**:

   ```python
   class CalendarEvent(Base):
       __tablename__ = "calendar_events"

       id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
       title = Column(String, nullable=False)
       description = Column(Text, nullable=True)
       family_id = Column(UUID(as_uuid=True), ForeignKey("families.id"), nullable=False)
       start_time = Column(DateTime, nullable=False)
       end_time = Column(DateTime, nullable=False)
       all_day = Column(Boolean, default=False)
       location = Column(String, nullable=True)
       created_by_id = Column(UUID(as_uuid=True), ForeignKey("users.id"), nullable=False)
       assignee_ids = Column(ARRAY(UUID(as_uuid=True)), nullable=True)  # å‚åŠ è€…ãƒªã‚¹ãƒˆ
       created_at = Column(DateTime, default=datetime.utcnow)
       updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)

       # ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—
       family = relationship("Family", back_populates="events")
       created_by = relationship("User", foreign_keys=[created_by_id])
   ```

2. **API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
   - `POST /api/v1/events` - ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ
   - `GET /api/v1/events` - ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§å–å¾—ï¼ˆæœŸé–“ã‚„ãƒ•ã‚£ãƒ«ã‚¿æŒ‡å®šå¯èƒ½ï¼‰
   - `GET /api/v1/events/{event_id}` - ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°å–å¾—
   - `PUT /api/v1/events/{event_id}` - ã‚¤ãƒ™ãƒ³ãƒˆæ›´æ–°
   - `DELETE /api/v1/events/{event_id}` - ã‚¤ãƒ™ãƒ³ãƒˆå‰Šé™¤

### çŒ®ç«‹ç®¡ç†æ©Ÿèƒ½

1. **ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«**:

   ```python
   class MealPlan(Base):
       __tablename__ = "meal_plans"

       id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
       family_id = Column(UUID(as_uuid=True), ForeignKey("families.id"), nullable=False)
       date = Column(Date, nullable=False)
       meal_type = Column(String, nullable=False)  # breakfast, lunch, dinner
       menu = Column(String, nullable=False)
       note = Column(Text, nullable=True)
       created_by_id = Column(UUID(as_uuid=True), ForeignKey("users.id"), nullable=False)
       created_at = Column(DateTime, default=datetime.utcnow)
       updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)

       # ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—
       family = relationship("Family", back_populates="meal_plans")
       created_by = relationship("User", foreign_keys=[created_by_id])

       __table_args__ = (UniqueConstraint('family_id', 'date', 'meal_type', name='uq_family_date_meal'),)
   ```

2. **è²·ã„ç‰©ãƒªã‚¹ãƒˆæ©Ÿèƒ½**:

   ```python
   class ShoppingItem(Base):
       __tablename__ = "shopping_items"

       id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
       family_id = Column(UUID(as_uuid=True), ForeignKey("families.id"), nullable=False)
       name = Column(String, nullable=False)
       quantity = Column(String, nullable=True)
       is_completed = Column(Boolean, default=False)
       note = Column(Text, nullable=True)
       related_meal_id = Column(UUID(as_uuid=True), ForeignKey("meal_plans.id"), nullable=True)
       created_by_id = Column(UUID(as_uuid=True), ForeignKey("users.id"), nullable=False)
       created_at = Column(DateTime, default=datetime.utcnow)
       updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)

       # ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—
       family = relationship("Family", back_populates="shopping_items")
       related_meal = relationship("MealPlan", back_populates="shopping_items")
       created_by = relationship("User", foreign_keys=[created_by_id])
   ```

3. **API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
   - `POST /api/v1/meal-plans` - çŒ®ç«‹ç™»éŒ²
   - `GET /api/v1/meal-plans` - çŒ®ç«‹ä¸€è¦§å–å¾—ï¼ˆæœŸé–“æŒ‡å®šå¯èƒ½ï¼‰
   - `PUT /api/v1/meal-plans/{meal_id}` - çŒ®ç«‹æ›´æ–°
   - `DELETE /api/v1/meal-plans/{meal_id}` - çŒ®ç«‹å‰Šé™¤
   - `POST /api/v1/shopping-items` - è²·ã„ç‰©ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ è¿½åŠ 
   - `GET /api/v1/shopping-items` - è²·ã„ç‰©ãƒªã‚¹ãƒˆå–å¾—
   - `PUT /api/v1/shopping-items/{item_id}` - è²·ã„ç‰©ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ æ›´æ–°
   - `DELETE /api/v1/shopping-items/{item_id}` - è²·ã„ç‰©ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ å‰Šé™¤

### ãŠå‡ºã‹ã‘ã‚¹ãƒãƒƒãƒˆç®¡ç†æ©Ÿèƒ½

1. **ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«**:

   ```python
   class OutingSpot(Base):
       __tablename__ = "outing_spots"

       id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
       family_id = Column(UUID(as_uuid=True), ForeignKey("families.id"), nullable=False)
       name = Column(String, nullable=False)
       description = Column(Text, nullable=True)
       location = Column(String, nullable=True)
       website = Column(String, nullable=True)
       is_indoor = Column(Boolean, nullable=True)
       is_outdoor = Column(Boolean, nullable=True)
       is_free = Column(Boolean, nullable=True)
       is_rainy_day = Column(Boolean, nullable=True)  # é›¨ã®æ—¥OK
       notes = Column(Text, nullable=True)
       created_by_id = Column(UUID(as_uuid=True), ForeignKey("users.id"), nullable=False)
       created_at = Column(DateTime, default=datetime.utcnow)
       updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)

       # ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—
       family = relationship("Family", back_populates="outing_spots")
       created_by = relationship("User", foreign_keys=[created_by_id])
       tags = relationship("SpotTag", secondary="spot_tags", back_populates="spots")
   ```

2. **ã‚¹ãƒãƒƒãƒˆã‚¿ã‚°æ©Ÿèƒ½**:

   ```python
   class SpotTag(Base):
       __tablename__ = "spot_tags"

       id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
       name = Column(String, nullable=False)
       color = Column(String, nullable=True)
       family_id = Column(UUID(as_uuid=True), ForeignKey("families.id"), nullable=False)

       # ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—
       family = relationship("Family", back_populates="spot_tags")
       spots = relationship("OutingSpot", secondary="spot_outing_tags", back_populates="tags")

       __table_args__ = (UniqueConstraint('name', 'family_id', name='uq_spot_tag_name_family'),)
   ```

3. **API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
   - `POST /api/v1/outing-spots` - ãŠå‡ºã‹ã‘ã‚¹ãƒãƒƒãƒˆç™»éŒ²
   - `GET /api/v1/outing-spots` - ãŠå‡ºã‹ã‘ã‚¹ãƒãƒƒãƒˆä¸€è¦§å–å¾—ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¯èƒ½ï¼‰
   - `GET /api/v1/outing-spots/{spot_id}` - ãŠå‡ºã‹ã‘ã‚¹ãƒãƒƒãƒˆè©³ç´°å–å¾—
   - `PUT /api/v1/outing-spots/{spot_id}` - ãŠå‡ºã‹ã‘ã‚¹ãƒãƒƒãƒˆæ›´æ–°
   - `DELETE /api/v1/outing-spots/{spot_id}` - ãŠå‡ºã‹ã‘ã‚¹ãƒãƒƒãƒˆå‰Šé™¤
   - `POST /api/v1/spot-tags` - ã‚¹ãƒãƒƒãƒˆã‚¿ã‚°ä½œæˆ
   - `GET /api/v1/spot-tags/family/{family_id}` - ã‚¹ãƒãƒƒãƒˆã‚¿ã‚°ä¸€è¦§å–å¾—
   - `PUT /api/v1/spot-tags/{tag_id}` - ã‚¹ãƒãƒƒãƒˆã‚¿ã‚°æ›´æ–°
   - `DELETE /api/v1/spot-tags/{tag_id}` - ã‚¹ãƒãƒƒãƒˆã‚¿ã‚°å‰Šé™¤

## èªè¨¼ã¨èªå¯

### èªè¨¼æ–¹å¼

JWT (JSON Web Token) ã‚’ä½¿ç”¨ã—ãŸãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹ã®èªè¨¼ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã« JWT ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã—ã€ä»¥é™ã® API ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ã¯`Authorization: Bearer <token>`ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä»˜ä¸ã—ã¾ã™ã€‚

### èªå¯ãƒãƒªã‚·ãƒ¼

- å„ãƒªã‚½ãƒ¼ã‚¹ï¼ˆã‚¿ã‚¹ã‚¯ã€å®¶æ—ãªã©ï¼‰ã«ã¯æ‰€æœ‰è€…ï¼ˆå®¶æ—ï¼‰ãŒè¨­å®šã•ã‚Œã¾ã™ã€‚
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ãŒæ‰€å±ã™ã‚‹å®¶æ—ã®ãƒªã‚½ãƒ¼ã‚¹ã®ã¿ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚
- ç®¡ç†è€…æ¨©é™ã‚’æŒã¤å®¶æ—ãƒ¡ãƒ³ãƒãƒ¼ã®ã¿ãŒã€å®¶æ—è¨­å®šã®å¤‰æ›´ã‚„å®¶æ—ãƒ¡ãƒ³ãƒãƒ¼ã®è¿½åŠ ãƒ»å‰Šé™¤ã‚’è¡Œãˆã¾ã™ã€‚

## éæ©Ÿèƒ½è¦ä»¶

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

- selectinload ã‚’ä½¿ç”¨ã—ãŸé–¢é€£ãƒ¢ãƒ‡ãƒ«ã®å…ˆèª­ã¿ã«ã‚ˆã‚‹ N+1å•é¡Œã®å›é¿
- é©åˆ‡ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­å®šã«ã‚ˆã‚‹ã‚¯ã‚¨ãƒªé«˜é€ŸåŒ–
- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹å¤§é‡ãƒ‡ãƒ¼ã‚¿å–å¾—ã®æœ€é©åŒ–

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–

- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯bcryptã§ãƒãƒƒã‚·ãƒ¥åŒ–ã—ã¦ä¿å­˜
- JWTãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™è¨­å®š
- ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
- CORSã®é©åˆ‡ãªè¨­å®š
- HTTPSã®ä½¿ç”¨ï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰
- å…¥åŠ›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®å¾¹åº•ï¼ˆPydanticã«ã‚ˆã‚‹å‹ãƒã‚§ãƒƒã‚¯ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–ï¼ˆSQLAlchemyã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªï¼‰
